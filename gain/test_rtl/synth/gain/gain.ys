# yosys script for gain.v

# Read the Verilog file
read_verilog gain.v

# Synthesize the design for Gowin FPs
# The 'synth_gowin' command is a high-level script that includes
# technology mapping, DSP inference, and packing for Gowin devices.
# It automatically handles many of the passes needed for optimal synthesis.
# The -family GW2A is for the Tang Nano 20K (GW2A-18C).
# The -device GW2A-18C specifies the exact device.
synth_gowin -top gain -family GW2A -json gain_synth.json

# If you want to see the netlist before and after packing (optional, for debugging)
# show -prefix pre_pack
# gowin_pack -dsp # This would be used if you were doing manual passes


# Synthesize the design
synth -top gain

# Generate a simple netlist graph (for visualization)
# This is done every iteration.
show -prefix maf_iter_01

# Clean up unused cells and wires
clean

# Second Iteration
#show -prefix maf_iter_02
clean

#Third Iteration
#show -prefix maf_iter_03
clean

# Fourth Iteration
#show -prefix maf_iter_04
clean

# Fifth Iteration
#show -prefix maf_iter_05
clean

# Sixth Iteration
#show -prefix maf_iter_06
clean

# Seventh Iteration
#show -prefix maf_iter_07
clean

# Eighth Iteration
#show -prefix maf_iter_08
clean

# Ninth Iteration
#show -prefix maf_iter_09
clean

# Tenth Iteration
#show -prefix maf_iter_10
clean

# Generate a final netlist graph (after all optimizations)
#show -prefix maf_final

# Write the synthesized netlist to a file (optional)
write_verilog template_synth.v

# Print statistics
stat